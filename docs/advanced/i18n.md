# Internationalization (i18n)

Build truly global applications with PhilJS's comprehensive internationalization system. Support multiple languages, regions, and cultures with reactive locale switching, automatic translations, and built-in formatting utilities.

## What You'll Learn

- Translation setup patterns
- Dynamic language switching with signals
- Pluralization and interpolation
- Date, number, and currency formatting
- RTL (right-to-left) support
- Route-based locale detection
- Lazy loading translations
- Type-safe translation keys
- AI-powered translation tools
- Best practices for global apps

## Why i18n?

Internationalization enables:

- **Global Reach**: Serve users in their native language
- **Better UX**: Users prefer content in their language
- **Market Expansion**: Enter new markets easily
- **Compliance**: Meet regional requirements
- **Accessibility**: Support diverse audiences

## Quick Start

PhilJS includes a complete i18n system in the core package - no additional installation required!

### Basic Configuration

```typescript
// src/i18n/config.ts
import { I18nProvider, type I18nConfig } from 'philjs-core';

export const i18nConfig: I18nConfig = {
  defaultLocale: 'en',
  locales: ['en', 'es', 'fr', 'de', 'ja', 'ar'],
  fallbackLocale: 'en',
  autoDetect: true, // Detect from browser/URL
  routePattern: '/[locale]/*', // Optional: URL-based locales
  messages: {
    en: enTranslations,
    es: esTranslations,
    fr: frTranslations,
    de: deTranslations,
    ja: jaTranslations,
    ar: arTranslations
  }
};

export type Locale = 'en' | 'es' | 'fr' | 'de' | 'ja' | 'ar';
```

### Translation Files Structure

Organize translations by namespace for maintainability:

```typescript
// src/i18n/locales/en.ts
import type { Translations } from 'philjs-core';

export const en: Translations = {
  // Common UI strings
  common: {
    welcome: 'Welcome',
    goodbye: 'Goodbye',
    submit: 'Submit',
    cancel: 'Cancel',
    save: 'Save',
    delete: 'Delete',
    edit: 'Edit',
    loading: 'Loading...',
    error: 'An error occurred'
  },

  // Navigation
  nav: {
    home: 'Home',
    about: 'About',
    contact: 'Contact',
    blog: 'Blog',
    docs: 'Documentation'
  },

  // Authentication
  auth: {
    login: 'Log In',
    logout: 'Log Out',
    register: 'Sign Up',
    forgotPassword: 'Forgot Password?',
    resetPassword: 'Reset Password',
    emailPlaceholder: 'Enter your email',
    passwordPlaceholder: 'Enter your password'
  },

  // Error messages
  errors: {
    notFound: 'Page not found',
    serverError: 'Internal server error',
    unauthorized: 'Unauthorized access',
    validation: {
      required: 'This field is required',
      email: 'Invalid email address',
      minLength: 'Must be at least {min} characters',
      maxLength: 'Must be no more than {max} characters'
    }
  },

  // Product catalog
  products: {
    title: 'Our Products',
    price: 'Price',
    addToCart: 'Add to Cart',
    outOfStock: 'Out of Stock',
    description: 'Description',
    reviews: '{count} reviews',
    rating: '{stars} out of 5 stars'
  },

  // Shopping cart with pluralization
  cart: {
    title: 'Shopping Cart',
    empty: 'Your cart is empty',
    items: '{"zero":"No items","one":"1 item","other":"{count} items"}',
    subtotal: 'Subtotal',
    checkout: 'Proceed to Checkout',
    remove: 'Remove from cart'
  }
};

// src/i18n/locales/es.ts
export const es: Translations = {
  common: {
    welcome: 'Bienvenido',
    goodbye: 'Adi√≥s',
    submit: 'Enviar',
    cancel: 'Cancelar',
    save: 'Guardar',
    delete: 'Eliminar',
    edit: 'Editar',
    loading: 'Cargando...',
    error: 'Ocurri√≥ un error'
  },

  nav: {
    home: 'Inicio',
    about: 'Acerca de',
    contact: 'Contacto',
    blog: 'Blog',
    docs: 'Documentaci√≥n'
  },

  auth: {
    login: 'Iniciar Sesi√≥n',
    logout: 'Cerrar Sesi√≥n',
    register: 'Registrarse',
    forgotPassword: '¬øOlvidaste tu contrase√±a?',
    resetPassword: 'Restablecer Contrase√±a',
    emailPlaceholder: 'Ingresa tu correo',
    passwordPlaceholder: 'Ingresa tu contrase√±a'
  },

  errors: {
    notFound: 'P√°gina no encontrada',
    serverError: 'Error interno del servidor',
    unauthorized: 'Acceso no autorizado',
    validation: {
      required: 'Este campo es obligatorio',
      email: 'Direcci√≥n de correo inv√°lida',
      minLength: 'Debe tener al menos {min} caracteres',
      maxLength: 'No debe tener m√°s de {max} caracteres'
    }
  },

  products: {
    title: 'Nuestros Productos',
    price: 'Precio',
    addToCart: 'A√±adir al Carrito',
    outOfStock: 'Agotado',
    description: 'Descripci√≥n',
    reviews: '{count} rese√±as',
    rating: '{stars} de 5 estrellas'
  },

  cart: {
    title: 'Carrito de Compras',
    empty: 'Tu carrito est√° vac√≠o',
    items: '{"zero":"Sin art√≠culos","one":"1 art√≠culo","other":"{count} art√≠culos"}',
    subtotal: 'Subtotal',
    checkout: 'Proceder al Pago',
    remove: 'Eliminar del carrito'
  }
};

// src/i18n/locales/fr.ts
export const fr: Translations = {
  common: {
    welcome: 'Bienvenue',
    goodbye: 'Au revoir',
    submit: 'Soumettre',
    cancel: 'Annuler',
    save: 'Enregistrer',
    delete: 'Supprimer',
    edit: 'Modifier',
    loading: 'Chargement...',
    error: 'Une erreur est survenue'
  },

  nav: {
    home: 'Accueil',
    about: '√Ä propos',
    contact: 'Contact',
    blog: 'Blog',
    docs: 'Documentation'
  },

  auth: {
    login: 'Se connecter',
    logout: 'Se d√©connecter',
    register: "S'inscrire",
    forgotPassword: 'Mot de passe oubli√©?',
    resetPassword: 'R√©initialiser le mot de passe',
    emailPlaceholder: 'Entrez votre email',
    passwordPlaceholder: 'Entrez votre mot de passe'
  },

  errors: {
    notFound: 'Page non trouv√©e',
    serverError: 'Erreur interne du serveur',
    unauthorized: 'Acc√®s non autoris√©',
    validation: {
      required: 'Ce champ est obligatoire',
      email: 'Adresse email invalide',
      minLength: 'Doit contenir au moins {min} caract√®res',
      maxLength: 'Ne doit pas d√©passer {max} caract√®res'
    }
  },

  products: {
    title: 'Nos Produits',
    price: 'Prix',
    addToCart: 'Ajouter au Panier',
    outOfStock: 'Rupture de stock',
    description: 'Description',
    reviews: '{count} avis',
    rating: '{stars} sur 5 √©toiles'
  },

  cart: {
    title: 'Panier',
    empty: 'Votre panier est vide',
    items: '{"zero":"Aucun article","one":"1 article","other":"{count} articles"}',
    subtotal: 'Sous-total',
    checkout: 'Passer la commande',
    remove: 'Retirer du panier'
  }
};

// src/i18n/locales/index.ts
export { en } from './en';
export { es } from './es';
export { fr } from './fr';

// Type helpers
export type TranslationKeys = string; // Will be type-safe with helper below
```

## Using Translations

### Setup Application with I18n

Wrap your app with the I18nProvider:

```typescript
// src/App.tsx
import { I18nProvider, type I18nConfig } from 'philjs-core';
import { en, es, fr } from './i18n/locales';

const i18nConfig: I18nConfig = {
  defaultLocale: 'en',
  locales: ['en', 'es', 'fr'],
  fallbackLocale: 'en',
  autoDetect: true,
  messages: { en, es, fr }
};

export function App() {
  return (
    <I18nProvider config={i18nConfig}>
      <MainApp />
    </I18nProvider>
  );
}

function MainApp() {
  return (
    <div>
      <Header />
      <LanguageSwitcher />
      <Content />
      <Footer />
    </div>
  );
}
```

### Basic Translation Usage

Use the `useI18n` hook to access translations:

```typescript
import { useI18n } from 'philjs-core';

function WelcomeMessage() {
  const { t, locale } = useI18n();

  return (
    <div>
      <h1>{t('common.welcome')}</h1>
      <p>{t('common.goodbye')}</p>
      <span>Current locale: {locale()}</span>
    </div>
  );
}
```

### Variable Interpolation

Pass variables to translations using the `vars` option:

```typescript
function UserProfile({ user }: { user: User }) {
  const { t } = useI18n();

  return (
    <div>
      <h2>{t('profile.greeting', { vars: { name: user.name } })}</h2>
      <p>{t('profile.memberSince', { vars: { year: user.joinedYear } })}</p>
    </div>
  );
}

// Translation strings:
// "profile.greeting": "Hello, {name}!"
// "profile.memberSince": "Member since {year}"
```

### Simple Translation Hook

For components that only need the `t` function:

```typescript
import { useTranslation } from 'philjs-core';

function SimpleButton() {
  const t = useTranslation();

  return <button>{t('common.submit')}</button>;
}
```

## Dynamic Language Switching

### Interactive Language Selector

PhilJS signals make locale switching seamless and reactive:

```typescript
import { signal, effect, useI18n } from 'philjs-core';

const languages = [
  { code: 'en', name: 'English', flag: 'üá∫üá∏', dir: 'ltr' },
  { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏', dir: 'ltr' },
  { code: 'fr', name: 'Fran√ßais', flag: 'üá´üá∑', dir: 'ltr' },
  { code: 'de', name: 'Deutsch', flag: 'üá©üá™', dir: 'ltr' },
  { code: 'ja', name: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ', dir: 'ltr' },
  { code: 'ar', name: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', flag: 'üá∏üá¶', dir: 'rtl' }
];

export function LanguageSelector() {
  const { locale, setLocale, getAvailableLocales } = useI18n();
  const isOpen = signal(false);
  const currentLang = () => languages.find(l => l.code === locale());

  // Automatically update document attributes when locale changes
  effect(() => {
    const lang = currentLang();
    document.documentElement.lang = locale();
    document.documentElement.dir = lang?.dir || 'ltr';
  });

  return (
    <div class="language-selector">
      <button
        onClick={() => isOpen.set(!isOpen())}
        aria-label="Select language"
        aria-expanded={isOpen()}
      >
        <span class="flag">{currentLang()?.flag}</span>
        <span class="name">{currentLang()?.name}</span>
        <span class="icon">{isOpen() ? '‚ñ≤' : '‚ñº'}</span>
      </button>

      {isOpen() && (
        <div class="language-menu" role="menu">
          {languages
            .filter(lang => getAvailableLocales().includes(lang.code))
            .map(lang => (
              <button
                key={lang.code}
                role="menuitem"
                onClick={() => {
                  setLocale(lang.code);
                  isOpen.set(false);
                }}
                class={locale() === lang.code ? 'active' : ''}
                aria-current={locale() === lang.code ? 'true' : undefined}
              >
                <span class="flag">{lang.flag}</span>
                <span class="name">{lang.name}</span>
                {locale() === lang.code && <span class="check">‚úì</span>}
              </button>
            ))}
        </div>
      )}
    </div>
  );
}
```

### Compact Locale Dropdown

A simpler dropdown-based selector:

```typescript
function CompactLanguageSelector() {
  const { locale, setLocale, t } = useI18n();

  return (
    <select
      value={locale()}
      onChange={(e) => setLocale(e.target.value)}
      aria-label={t('nav.selectLanguage')}
    >
      <option value="en">English</option>
      <option value="es">Espa√±ol</option>
      <option value="fr">Fran√ßais</option>
      <option value="de">Deutsch</option>
      <option value="ja">Êó•Êú¨Ë™û</option>
      <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
    </select>
  );
}
```

### Persist Locale Preference

PhilJS's `autoDetect` feature automatically saves locale preferences:

```typescript
// The I18nProvider automatically handles:
// 1. Loading from localStorage ('philjs_locale')
// 2. Saving on locale change
// 3. Browser language detection

// Custom persistence example:
function useLocalePersistence() {
  const { locale, setLocale } = useI18n();

  // Save to localStorage whenever locale changes
  effect(() => {
    localStorage.setItem('user_locale', locale());
  });

  // Save to server for logged-in users
  effect(async () => {
    if (isAuthenticated()) {
      await saveUserPreference({ locale: locale() });
    }
  });

  return { locale, setLocale };
}

// Usage in component
function Settings() {
  const { locale, setLocale } = useLocalePersistence();

  return (
    <div>
      <h2>Language Preferences</h2>
      <select value={locale()} onChange={(e) => setLocale(e.target.value)}>
        <option value="en">English</option>
        <option value="es">Espa√±ol</option>
        <option value="fr">Fran√ßais</option>
      </select>
    </div>
  );
}
```

### URL-Based Locale Detection

Configure route-based locale detection for SEO-friendly URLs:

```typescript
import { I18nProvider, type I18nConfig, createLocaleMiddleware } from 'philjs-core';
import { en, es, fr } from './i18n/locales';

// Configure with route pattern
const i18nConfig: I18nConfig = {
  defaultLocale: 'en',
  locales: ['en', 'es', 'fr'],
  fallbackLocale: 'en',
  autoDetect: true,
  routePattern: '/[locale]/*', // Matches /en/about, /es/productos, etc.
  messages: { en, es, fr }
};

// App structure with locale in URL
function App() {
  return (
    <I18nProvider config={i18nConfig}>
      <Router>
        <Route path="/:locale/*" component={LocalizedRoutes} />
        <Route path="/*" component={RedirectToDefaultLocale} />
      </Router>
    </I18nProvider>
  );
}

function RedirectToDefaultLocale() {
  const { locale } = useI18n();

  useEffect(() => {
    const currentPath = window.location.pathname;
    window.location.href = `/${locale()}${currentPath}`;
  }, []);

  return <div>Redirecting...</div>;
}

function LocalizedRoutes() {
  const { params } = useRouter();
  const { locale, setLocale } = useI18n();

  // Sync URL param with i18n locale
  useEffect(() => {
    if (params.locale && params.locale !== locale()) {
      setLocale(params.locale);
    }
  }, [params.locale]);

  return (
    <div>
      <Route path="/:locale/" component={HomePage} />
      <Route path="/:locale/about" component={AboutPage} />
      <Route path="/:locale/products" component={ProductsPage} />
      <Route path="/:locale/contact" component={ContactPage} />
    </div>
  );
}

// Helper for locale-aware navigation
function useLocalizedNavigate() {
  const { locale } = useI18n();
  const navigate = useNavigate();

  return (path: string) => {
    navigate(`/${locale()}${path}`);
  };
}

// Usage
function Navigation() {
  const navigate = useLocalizedNavigate();
  const { t } = useI18n();

  return (
    <nav>
      <a onClick={() => navigate('/')}>{t('nav.home')}</a>
      <a onClick={() => navigate('/about')}>{t('nav.about')}</a>
      <a onClick={() => navigate('/products')}>{t('nav.products')}</a>
    </nav>
  );
}
```

### Server-Side Locale Detection

Detect locale on the server using request headers:

```typescript
import { createLocaleMiddleware, type I18nConfig } from 'philjs-core';

// Express/Node.js middleware
export function createI18nMiddleware(config: I18nConfig) {
  const detectLocale = createLocaleMiddleware(config);

  return (req: Request, res: Response, next: NextFunction) => {
    // Detect from URL, Accept-Language header, or cookie
    const locale = detectLocale(req);

    // Store in request for SSR
    req.locale = locale;

    // Set HTML lang attribute
    res.locals.locale = locale;
    res.locals.dir = ['ar', 'he', 'fa'].includes(locale) ? 'rtl' : 'ltr';

    next();
  };
}

// Usage
app.use(createI18nMiddleware(i18nConfig));
```

## Formatting

### Date Formatting

```typescript
export function useI18n() {
  const context = useContext(I18nContext);

  const formatDate = (date: Date, options?: Intl.DateTimeFormatOptions) => {
    return new Intl.DateTimeFormat(context.locale(), options).format(date);
  };

  const formatRelativeTime = (date: Date): string => {
    const now = new Date();
    const diff = date.getTime() - now.getTime();
    const seconds = Math.floor(diff / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    const rtf = new Intl.RelativeTimeFormat(context.locale(), {
      numeric: 'auto'
    });

    if (Math.abs(days) > 0) return rtf.format(days, 'day');
    if (Math.abs(hours) > 0) return rtf.format(hours, 'hour');
    if (Math.abs(minutes) > 0) return rtf.format(minutes, 'minute');
    return rtf.format(seconds, 'second');
  };

  return {
    ...context,
    formatDate,
    formatRelativeTime
  };
}

// Usage
function BlogPost({ post }: { post: Post }) {
  const { formatDate, formatRelativeTime } = useI18n();

  return (
    <article>
      <h1>{post.title}</h1>
      <time>{formatDate(new Date(post.date), { dateStyle: 'long' })}</time>
      <p>{formatRelativeTime(new Date(post.date))}</p>
    </article>
  );
}
```

### Number Formatting

```typescript
export function useI18n() {
  const context = useContext(I18nContext);

  const formatNumber = (value: number, options?: Intl.NumberFormatOptions) => {
    return new Intl.NumberFormat(context.locale(), options).format(value);
  };

  const formatCurrency = (value: number, currency: string = 'USD') => {
    return new Intl.NumberFormat(context.locale(), {
      style: 'currency',
      currency
    }).format(value);
  };

  const formatPercent = (value: number) => {
    return new Intl.NumberFormat(context.locale(), {
      style: 'percent',
      minimumFractionDigits: 0,
      maximumFractionDigits: 2
    }).format(value);
  };

  return {
    ...context,
    formatNumber,
    formatCurrency,
    formatPercent
  };
}

// Usage
function ProductPrice({ price, currency }: { price: number; currency: string }) {
  const { formatCurrency } = useI18n();

  return <span className="price">{formatCurrency(price, currency)}</span>;
}
```

### List Formatting

```typescript
export function useI18n() {
  const context = useContext(I18nContext);

  const formatList = (items: string[], type: 'conjunction' | 'disjunction' = 'conjunction') => {
    return new Intl.ListFormat(context.locale(), {
      style: 'long',
      type
    }).format(items);
  };

  return {
    ...context,
    formatList
  };
}

// Usage
function TagList({ tags }: { tags: string[] }) {
  const { formatList } = useI18n();

  return <p>Tags: {formatList(tags)}</p>;
  // en: "Tags: React, TypeScript, and JavaScript"
  // es: "Tags: React, TypeScript y JavaScript"
}
```

## Pluralization

### Plural Rules

```typescript
export function useI18n() {
  const context = useContext(I18nContext);

  const plural = (
    count: number,
    translations: { zero?: string; one: string; other: string }
  ): string => {
    const rules = new Intl.PluralRules(context.locale());
    const rule = rules.select(count);

    if (count === 0 && translations.zero) {
      return translations.zero.replace('{count}', String(count));
    }

    const translation = translations[rule as 'one' | 'other'] || translations.other;
    return translation.replace('{count}', String(count));
  };

  return {
    ...context,
    plural
  };
}

// Usage
function ItemCount({ count }: { count: number }) {
  const { plural } = useI18n();

  return (
    <p>
      {plural(count, {
        zero: 'No items',
        one: '{count} item',
        other: '{count} items'
      })}
    </p>
  );
}
```

## RTL Support

### Detect RTL Languages

```typescript
const RTL_LANGUAGES = ['ar', 'he', 'fa', 'ur'];

export function useI18n() {
  const context = useContext(I18nContext);

  const isRTL = () => RTL_LANGUAGES.includes(context.locale());
  const direction = () => isRTL() ? 'rtl' : 'ltr';

  return {
    ...context,
    isRTL,
    direction
  };
}
```

### Apply RTL Styles

```typescript
import { effect } from 'philjs-core';
import { useI18n } from './i18n';

function App() {
  const { direction } = useI18n();

  effect(() => {
    document.documentElement.dir = direction();
    document.documentElement.lang = locale();
  });

  return <div>{/* app content */}</div>;
}
```

### RTL-Aware Styles

```css
/* Logical properties (automatically flip in RTL) */
.container {
  margin-inline-start: 20px; /* margin-left in LTR, margin-right in RTL */
  padding-inline-end: 10px;  /* padding-right in LTR, padding-left in RTL */
}

/* RTL-specific styles */
[dir='rtl'] .icon {
  transform: scaleX(-1); /* Flip icons */
}

[dir='rtl'] .text {
  text-align: right;
}
```

## Lazy Loading Translations

```typescript
async function loadTranslations(locale: Locale): Promise<Translations> {
  const module = await import(`./locales/${locale}.ts`);
  return module.default;
}

export function I18nProvider({ children }: { children: JSX.Element }) {
  const locale = signal<Locale>('en');
  const translations = signal<Translations | null>(null);

  effect(async () => {
    const trans = await loadTranslations(locale());
    translations.set(trans);
  });

  if (!translations()) {
    return <div>Loading translations...</div>;
  }

  const t = (key: string): string => {
    const keys = key.split('.');
    let value: any = translations();

    for (const k of keys) {
      value = value?.[k];
    }

    return typeof value === 'string' ? value : key;
  };

  return (
    <I18nContext.Provider value={{ locale, setLocale: locale.set, t }}>
      {children}
    </I18nContext.Provider>
  );
}
```

## Best Practices

### Type-Safe Translations

```typescript
// Generate types from translations
type DeepKeys<T, K extends string = ''> = T extends object
  ? {
      [P in keyof T]: P extends string
        ? DeepKeys<T[P], `${K}${K extends '' ? '' : '.'}${P}`>
        : never;
    }[keyof T]
  : K;

type TranslationKeys = DeepKeys<typeof en>;

// Type-safe t function
const t = (key: TranslationKeys, params?: Record<string, any>): string => {
  // ... implementation
};

// Usage - autocomplete and type checking!
t('common.welcome'); // ‚úì
t('nav.home'); // ‚úì
t('invalid.key'); // ‚úó Type error
```

### Extract Reusable Strings

```typescript
// ‚úÖ Keep UI strings in translations
const translations = {
  buttons: {
    save: 'Save',
    cancel: 'Cancel',
    delete: 'Delete'
  }
};

// ‚ùå Don't hardcode strings
<button>Save</button>

// ‚úÖ Use translations
<button>{t('buttons.save')}</button>
```

### Namespace Translations

```typescript
// Group related translations
export const en = {
  pages: {
    home: {
      title: 'Welcome Home',
      subtitle: 'Get started with PhilJS'
    },
    about: {
      title: 'About Us',
      description: 'Learn more about our company'
    }
  },
  components: {
    header: {
      login: 'Log In',
      signup: 'Sign Up'
    }
  }
};
```

### Handle Missing Translations

```typescript
const t = (key: string, params?: Record<string, any>): string => {
  const keys = key.split('.');
  let value: any = translations[locale()];

  for (const k of keys) {
    value = value?.[k];
  }

  // Missing translation - try fallback locale
  if (typeof value !== 'string') {
    value = translations[fallbackLocale];
    for (const k of keys) {
      value = value?.[k];
    }
  }

  // Still missing - log warning and return key
  if (typeof value !== 'string') {
    console.warn(`Missing translation: ${key} for locale ${locale()}`);
    return key;
  }

  return value;
};
```

## Summary

You've learned:

‚úÖ i18n fundamentals and setup
‚úÖ Translation file organization
‚úÖ Using translations in components
‚úÖ Locale switching and persistence
‚úÖ Date, number, and list formatting
‚úÖ Pluralization support
‚úÖ RTL language support
‚úÖ Lazy loading translations
‚úÖ Type-safe translations
‚úÖ Best practices for i18n

i18n enables your app to reach a global audience!

---

**Next:** [Authentication ‚Üí](./authentication.md) Secure your application
