# Internationalization (i18n) Patterns

Localize PhilJS apps with predictable fallbacks and performance in mind.

## Principles

- Extract all user-facing strings; avoid concatenation that breaks grammar.
- Keep locale data lean; lazy-load per locale/namespace.
- Provide sane fallbacks and error handling for missing translations.

## Setup

- Store messages in JSON per locale/namespace.
- Use `@philjs/i18n` (if available) or a lightweight library; avoid bloated runtimes.
- Detect locale from URL, headers, or user settings; persist choice.

## Usage

```tsx
import { t } from '@philjs/i18n';

function Welcome() {
  return <h1>{t('welcome.title', 'Welcome')}</h1>;
}
```

## Loading strategy

- Load base locale on first render; lazy-load additional namespaces per route.
- Cache translations per locale; invalidate on deploy/version bump.
- For SSR, prefetch required namespaces and serialize them.

## Plurals and formatting

- Use ICU/messageformat for plurals, gender, and select cases.
- Handle dates/numbers with Intl APIs; memoize formatters per locale.

## Forms and validation

- Localize validation messages; keep schemas and messages together.
- Respect locale for number/date parsing.

## Testing

- Snapshot critical pages in multiple locales for layout regressions (rtl/ltr).
- Unit-test formatter outputs.
- Ensure missing keys surface warnings in dev; have fallbacks in prod.

## Performance tips

- Avoid shipping all locales; tree-shake unused ones.
- Split locale bundles by route/namespace.
- Use streaming to send base UI fast, then hydrate localized pieces if needed.

## Checklist

- [ ] Locale detection + persistence.
- [ ] Lazy-loaded namespaces per route.
- [ ] Pluralization and formatting handled via Intl/ICU.
- [ ] RTL support tested.
- [ ] Missing key warnings in dev; fallbacks in prod.
